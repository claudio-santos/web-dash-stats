<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ðŸ“Š Web Dashboard Stats</title>
  <link href="/static/bootstrap.min.css" rel="stylesheet">
</head>
<body class="container py-5">
  <h1 class="mb-4">ðŸ“Š Web Dashboard Stats</h1>

  <!-- System Information Card -->
  <div class="card mb-4">
    <div class="card-header">System Info</div>
    <div class="card-body">
      <ul class="list-group list-group-flush">
        <li class="list-group-item d-flex justify-content-between align-items-center">
          <strong>Hostname</strong>
          <span id="hostname">Loading...</span>
        </li>
        <li class="list-group-item d-flex justify-content-between align-items-center">
          <strong>Platform</strong>
          <span id="platform">Loading...</span>
        </li>
        <li class="list-group-item d-flex justify-content-between align-items-center">
          <strong>CPU Model</strong>
          <span id="cpu-model">Loading...</span>
        </li>
        <li class="list-group-item d-flex justify-content-between align-items-center">
          <strong>Uptime</strong>
          <span id="uptime">Loading...</span>
        </li>
      </ul>
    </div>
  </div>

  <!-- CPU Usage Card -->
  <div class="card mb-3">
    <div class="card-header">CPU Usage</div>
    <div class="card-body">
      <div class="d-flex justify-content-between align-items-center mb-2">
        <span>Usage</span>
        <span id="cpu-val">0%</span>
      </div>
      <div class="progress" style="height: 1.5rem;">
        <div id="cpu-bar" class="progress-bar bg-success" role="progressbar" style="width: 0%"></div>
      </div>
    </div>
  </div>

  <!-- Memory Usage Card -->
  <div class="card mb-3">
    <div class="card-header">Memory Usage</div>
    <div class="card-body">
      <div class="d-flex justify-content-between align-items-center mb-2">
        <span>Usage</span>
        <span id="mem-val">0%</span>
      </div>
      <div class="progress" style="height: 1.5rem;">
        <div id="mem-bar" class="progress-bar bg-success" role="progressbar" style="width: 0%"></div>
      </div>
    </div>
  </div>

  <!-- Network Usage Card -->
  <div class="card">
    <div class="card-header">Network Usage</div>
    <div class="card-body">
      <ul class="list-group list-group-flush">
        <li class="list-group-item d-flex justify-content-between align-items-center">
          <strong>Downloaded</strong>
          <span id="rx">0 MB</span>
        </li>
        <li class="list-group-item d-flex justify-content-between align-items-center">
          <strong>Download Speed</strong>
          <span id="rate-rx">0.00 MB/s</span>
        </li>
        <li class="list-group-item d-flex justify-content-between align-items-center">
          <strong>Uploaded</strong>
          <span id="tx">0 MB</span>
        </li>
        <li class="list-group-item d-flex justify-content-between align-items-center">
          <strong>Upload Speed</strong>
          <span id="rate-tx">0.00 MB/s</span>
        </li>
      </ul>
    </div>
  </div>

  <script>
  const eventSource = new EventSource("/events");

  function formatBytes(bytes) {
    const gb = 1024 * 1024 * 1024;
    const mb = 1024 * 1024;
    if (bytes >= gb) {
      return (bytes / gb).toFixed(2) + " GB";
    }
    return (bytes / mb).toFixed(2) + " MB";
  }

  function formatRate(bytesPerSec) {
    const gb = 1024 * 1024 * 1024;
    const mb = 1024 * 1024;
    if (bytesPerSec >= gb) {
      return (bytesPerSec / gb).toFixed(2) + " GB/s";
    }
    return (bytesPerSec / mb).toFixed(2) + " MB/s";
  }

  // Set progress bar color and width based on percent
  function setBar(bar, percent) {
    bar.style.width = percent + "%";
    bar.classList.remove("bg-success", "bg-warning", "bg-danger");
    if (percent < 50) {
      bar.classList.add("bg-success");
    } else if (percent < 80) {
      bar.classList.add("bg-warning");
    } else {
      bar.classList.add("bg-danger");
    }
  }

  eventSource.onmessage = function(event) {
    let msg;
    try {
      msg = JSON.parse(event.data);
    } catch (e) {
      return;
    }
    const data = msg.data || {};

    if (msg.type === "sysinfo") {
      if (data.hostname) document.getElementById("hostname").textContent = data.hostname;
      if (data.platform) document.getElementById("platform").textContent = data.platform;
      if (data.cpu_model) document.getElementById("cpu-model").textContent = data.cpu_model;
    } else if (msg.type === "cpu") {
      if (typeof data.cpu === "number") {
        const val = data.cpu.toFixed(2);
        document.getElementById("cpu-val").textContent = val + "%";
        setBar(document.getElementById("cpu-bar"), val);
      }
    } else if (msg.type === "mem") {
      if (typeof data.mem === "number") {
        const val = data.mem.toFixed(2);
        document.getElementById("mem-val").textContent = val + "%";
        setBar(document.getElementById("mem-bar"), val);
      }
    } else if (msg.type === "uptime") {
      if (data.uptime) document.getElementById("uptime").textContent = data.uptime;
    } else if (msg.type === "network") {
      if (typeof data.rx === "number") document.getElementById("rx").textContent = formatBytes(data.rx);
      if (typeof data.tx === "number") document.getElementById("tx").textContent = formatBytes(data.tx);
      if (typeof data.rateRx === "number") document.getElementById("rate-rx").textContent = formatRate(data.rateRx);
      if (typeof data.rateTx === "number") document.getElementById("rate-tx").textContent = formatRate(data.rateTx);
    }
  };

  eventSource.onerror = function(err) {
    console.error("EventSource failed:", err);
  };
</script>
  <script src="/static/bootstrap.bundle.min.js"></script>
</body>
</html>
